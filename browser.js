var O={html(i){if(i!==void 0)return this.innerHTML=i,this;else return this.innerHTML},v(i){if(i!==void 0)return this.value=i,this;else return this.value},on(i,n){return this.addEventListener(i,n),this},css(i,n=null){if(typeof i==="string")if(n!==null)this.style[i]=n;else this.style.cssText=i;else Object.assign(this.style,i);return this},attrib(i,n=null){if(n!==null)return this.setAttribute(i,n),this;else return this.getAttribute(i)||""},clA(...i){return this.classList.add(...i),this},clR(...i){return this.classList.remove(...i),this},clT(i,n){return this.classList.toggle(i,n),this},animateFade(i,n={}){let{time:f=200,cb:c}=n,o=this,w=i===0?1:0,H=Math.min(1,Math.max(0,i)),$=performance.now();o.style.opacity=H.toString();function d(b){let D=b-$,x=Math.min(D/f,1),M=H+(w-H)*x;if(o.style.opacity=M.toString(),x<1)requestAnimationFrame(d);else o.style.opacity=w.toString(),c?.()}return requestAnimationFrame(d),this},fadeIn(...i){let n=k({display:"string",cb:"function",time:"number"},i),{display:f="block"}=n;return this.css("display",f),this.animateFade(0,n),this.fade=!0,this},fadeOut(...i){let n=k({cb:"function",time:"number"},i),f=n.time??300;return n.time=f,this.animateFade(1,{...n,cb:()=>{this.css("display","none"),n.cb?.()}}),this.fade=!1,this},async fadeInP(...i){return new Promise((n)=>{this.fadeIn(...i,()=>n(this))})},async fadeOutP(...i){return new Promise((n)=>{this.fadeOut(...i,()=>n(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(i){return this.appendChild(i),this},addUp(i){return this.insertBefore(i,this.firstChild),this},qs(i,n=0){if(n)i=`[data-id="${i}"]`;return this.querySelector(i)}};O.qi=O.qs;function k(i,n){let f={};if(n.length===0)return f;if(n.every((c)=>typeof c==="object"))return Object.assign({},...n);for(let c of n)for(let[o,w]of Object.entries(i))if(typeof c===w){f[o]=c;break}return f}Object.assign(HTMLElement.prototype,O);Object.assign(document,O);Object.assign(document.body,O);Object.assign(document.documentElement,O);window.qs=window.qi=O.qs.bind(document);var bi=new URLSearchParams(window.location.search),di=bi.get("zhiva-secret");function Y(i,n={},f={}){let c=new URL("/zhiva-api/"+i,window.location.origin);return Object.entries(f).forEach(([o,w])=>{c.searchParams.set(o,w.toString())}),fetch(c,{...n,headers:{...n.headers,"x-zhiva-token":di}})}async function m(i,n={},f={},c={}){return await Y(i,{method:"POST",...f,body:JSON.stringify(n),headers:{...f.headers,"Content-Type":"application/json"}},c).then((o)=>o.json())}async function r(i,n={},f={}){return await Y(i,n,f).then((c)=>c.json())}async function p(i,n={},f={}){console.log(`[BROWSER MODE] Mocked API call for: ${i}`,{options:n,query:f});let c=f?.app;switch(i){case"installed":return new Response(JSON.stringify({apps:[]}),{status:200,headers:{"Content-Type":"application/json"}});case"get-updates":return new Response(JSON.stringify({err:!1,updates:{}}),{status:200,headers:{"Content-Type":"application/json"}});case"install":return window.location.href=`zhiva://install/${c}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"start":return window.location.href=`zhiva://start/${c}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"uninstall":case"update":return console.warn(`Action "${i}" is not available in browser-only mode. Doing nothing.`),new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"apps":return new Response(JSON.stringify({err:!1,apps:await Di()}),{status:200,headers:{"Content-Type":"application/json"}});default:return console.error(`Endpoint not mocked for browser mode: ${i}`),new Response(JSON.stringify({err:!0,msg:"Endpoint not mocked for browser mode"}),{status:404,headers:{"Content-Type":"application/json"}})}}async function A(i,n,f,c=[]){let o=localStorage.getItem(i);if(o)return JSON.parse(o);let w=await f(...c);return localStorage.setItem(i,JSON.stringify(w)),setTimeout(()=>localStorage.removeItem(i),n),w}async function Di(){let i=await A("search",300000,Zi),n=await A("banned",300000,Li);i=i.filter((c)=>!n.includes(c.name));let f=await A("verified",300000,qi,[i.map((c)=>c.name)]);return i.forEach((c)=>c.verified=f.includes(c.name)),console.log("Fetched apps:",i),i}async function Zi(){return(await fetch("https://api.github.com/search/repositories?q=topic:Zhiva-app").then((n)=>n.json())).items.map((n)=>({name:n.full_name,desc:n.description,stars:n.stargazers_count}))}async function s(i){return(await fetch(`https://raw.githubusercontent.com/wxn0brP/Zhiva-registry/HEAD/${i}.txt`).then((f)=>f.text())).split(`
`).map((f)=>f.split("#")[0].trim()).filter(Boolean)}async function Li(){return await s("banned")}async function qi(i){let n=await s("verified");return n.push(...i.filter((f)=>f.startsWith("wxn0brP/"))),n}var L=typeof window.zhiva_isApp<"u";console.log("Running in",L?"desktop":"browser mode");var Z=L?Y:p;function g(i){return new Promise((n)=>setTimeout(n,i))}var F=document.querySelector("#FD-message"),Ci=document.querySelector("#FD-prompt");async function t(i,n={}){n={displayTime:6000,...n};let f=document.createElement("div");if(f.innerHTML=i,f.style.top=`-${f.offsetHeight+20}px`,n.className)f.classList.add(n.className);if(n.backgroundColor)f.style.backgroundColor=n.backgroundColor;let c=10,o=w();function w(){let d=0;for(let b of F.children)d+=b.offsetHeight+c;return d}let H=!1;async function $(){H=!0,f.style.top=`-${f.offsetHeight+20}px`,await g(700);for(let d of F.children){let b=d,D=parseInt(b.style.top.replace("px",""));b.style.top=`${D-c-f.offsetHeight}px`}f.remove()}if(f.addEventListener("click",$),n.onClick)f.addEventListener("click",n.onClick);if(F.appendChild(f),await g(100),f.style.top=`${10+o}px`,await g(n.displayTime-700),H)return;await $()}async function u(i,n={}){n={extraTime:0,...n};let f=0.3333333333333333,o={displayTime:(i.split(" ").length*f+6+n.extraTime)*1000,className:"uiMsg"};if(n.onClick)o.onClick=n.onClick;await t(i,o)}var N=["listeners","value","notify","get","getPointer","set","subscribe","parent","isStore"];function K(i,n){let f={};for(let c in i)if(i.hasOwnProperty(c))if(typeof i[c]==="object"&&!Array.isArray(i[c])&&i[c]!==null)f[c]=K(i[c],f);else f[c]=new G(i[c],f);return f.isStore=!0,f.listeners=[],f.value=void 0,f.parent=n,f.notify=(c=0)=>{if(f.listeners.forEach((o)=>o(f)),c>0&&n&&typeof n.notify==="function")n.notify(c-1);return f},f.get=()=>{let c={};for(let o in f){if(N.includes(o))continue;if(f.hasOwnProperty(o))c[o]=f[o].get()}return c},f.getPointer=()=>{let c={};for(let o in f){if(N.includes(o))continue;if(f.hasOwnProperty(o))c[o]=f[o]}return c},f.set=(c,o=0)=>{for(let w in c){if(N.includes(w))throw Error(`Reserved key: ${w}`);if(!f.hasOwnProperty(w))throw Error(`Unknown key: ${w}`);if(f[w].isStore)throw Error(`Cannot set nested store: ${w}`);let $=c[w];if(typeof $==="object"&&$!==null&&!Array.isArray($))throw Error(`Invalid value for key: ${w}`)}for(let w in c)f[w].set(c[w],o);return f},f.subscribe=(c)=>{return f.listeners.push(c),f},f}class G{value;parent;listeners=[];isStore=!1;constructor(i,n){this.value=i,this.parent=n}get(){return this.value}set(i,n=0){return this.value=i,this.notify(n),this}notify(i=0){if(this.listeners.forEach((n)=>n(this.value)),i>0&&this.parent&&typeof this.parent.notify==="function")this.parent.notify(i-1);return this}subscribe(i){return this.listeners.push(i),this}}function U(i,n,f=!1){if(f)n.set(i.checked);else i.checked=n.get();i.addEventListener("change",()=>{n.set(i.checked)}),n.subscribe((c)=>{if(i.checked!==c)i.checked=c})}var j=window?.VQLClient?.fetchVQL;function a(i,n){let f=typeof i.selector==="string"?document.querySelector(i.selector):i.selector;if(!f)throw Error(`mountView: selector '${i.selector}' not found`);async function c(H={}){let $,d=Object.assign({},i.queryArgs,H);if(i.queryFunction)$=await i.queryFunction(d,H);else if(typeof i.query==="string")$=await j({query:i.query,var:H});else if(typeof i.query==="function")$=await j(await i.query(d,H));else if(typeof i.query==="object"&&!Array.isArray(i.query))$=await j(i.query);else $=H;if(i.onData)i.onData($);if(i.transform)$=i.transform($);if(i.onDataTransform)i.onDataTransform($);if(i.sort){if(typeof i.sort==="function")$=$.sort(i.sort);else if(typeof i.sort==="string"){let b=i.sort;$=$.sort((D,x)=>{let M=D?.[b],E=x?.[b];return typeof M==="string"||typeof E==="string"?String(M).localeCompare(String(E)):(M??0)-(E??0)})}}if(i.onDataSort)i.onDataSort($);o($,i.templateDataMode??"replace")}if(i.events)for(let[H,$]of Object.entries(i.events))f.addEventListener(H,(d)=>{let b=d.target;for(let[D,x]of Object.entries($)){let M=b.closest(D);if(M&&f.contains(M)){x(M,d);break}}});function o(H,$="replace"){let d="",b=!1;if(Array.isArray(H)&&H.length===0||typeof H==="object"&&H!==null&&Object.keys(H).length===0||H===null||H===void 0)d=i.emptyData??"",b=!0;else d=Array.isArray(H)?H.map(i.template).join(""):i.template(H);if($==="append"||$==="prepend")if(b){if(f.innerHTML.trim()!==""&&f.getAttribute("data-fu-empty")!=="true")return;f.innerHTML=d,f.setAttribute("data-fu-empty","true")}else{if(f.getAttribute("data-fu-empty")==="true")f.innerHTML=d;else f.innerHTML=$==="append"?f.innerHTML+d:d+f.innerHTML;f.removeAttribute("data-fu-empty")}else if(f.innerHTML=d,b)f.setAttribute("data-fu-empty","true");else f.removeAttribute("data-fu-empty")}return Object.assign({element:f,mount:()=>{},load:c,render:o},n??{})}function l(i,n){return i.set(n(i.get())),i}function e(i,n=1){return i.set(i.get()+n),i}globalThis.lo=console.log;function _(i){let n=K({desktop:!1,menu:!1,not:!1}),f=i.qi("shortcut-not",1),c=i.qi("shortcut-desktop",1),o=i.qi("shortcut-menu",1);return n.not.subscribe((w)=>{if(w)c.disabled=!0,o.disabled=!0,c.checked=!1,o.checked=!1;else c.disabled=!1,o.disabled=!1}),U(c,n.desktop),U(o,n.menu),U(f,n.not),n}var S=qs("#settings"),V=qs("#save-shortcuts-btn"),Wi=qs("#open-settings"),q=_(S);async function hi(){let i=await r("shortcut-pref");if(!i.err&&i.data)q.menu.set(i.data.includes("m")),q.desktop.set(i.data.includes("d")),q.not.set(i.data.includes("n"));else q.menu.set(!1),q.desktop.set(!1),q.not.set(!1);if(i.err)console.error("Failed to load shortcut preferences:",i),u("Error")}async function xi(){let i="";if(q.desktop.get())i+="d";if(q.menu.get())i+="m";if(q.not.get())i="n";V.disabled=!0;let n=await m("shortcut-pref",{data:i});if(n.err){console.error("Failed to save shortcut preferences:",n),u("Error");return}u("\uD83D\uDC9C Preferences saved!"),V.disabled=!1}function ii(){if(!L)return;V.addEventListener("click",xi),S.fade=!1,Wi.addEventListener("click",()=>S.fadeToggle()),hi()}var J="https://raw.githubusercontent.com/",T=new G([]),R=new G(0),z=qs("#update-status"),ni="Available only in desktop app";async function I(){X.disabled=!0,z.innerHTML="Checking...",document.querySelectorAll(".repo-card").forEach((o)=>o.classList.remove("has-update"));let n=await(await Z("get-updates")).json(),f=n.updates;if(X.disabled=!L,n.err){console.error(`Error checking for updates: ${n.msg}`),z.innerHTML='<span style="color: red;">Error checking for updates</span>';return}let c=Object.keys(f).filter((o)=>f[o]);R.set(c.length),c.forEach((o)=>{let w=qs(`.repo-card[data-name="${o}"]`);if(w){w.classList.add("has-update");let H=w.qs(".install");if(H)H.textContent="Update available"}})}var X=qs("#check-updates-btn");if(!L)X.disabled=!0,X.title="";X.onclick=()=>{I(),localStorage.removeItem("reposCache")};var v=qs("#confirmation-modal"),fi=qs("#modal-message"),ci=qs("#modal-warning"),P=qs("#modal-confirm"),B=qs("#modal-cancel"),oi=v.qs(".shortcut-options"),Q=_(v);function y(i,n,f={}){if(!v||!fi||!ci||!P||!B)return;let c={showWarning:!1,...f};if(fi.textContent=i,ci.style.display=c.showWarning?"block":"none",v.style.display="flex",c.shortcutOptions)oi.style.display="",Q.set(q.get());else oi.style.display="none";let o=()=>{n(),H()},w=()=>{H()},H=()=>{v.style.display="none",P.removeEventListener("click",o),B.removeEventListener("click",w)};P.addEventListener("click",o),B.addEventListener("click",w)}function h(){document.querySelectorAll(".repo-card").forEach((i)=>{let n=i.getAttribute("data-name"),f=()=>{let b="";if(Q.desktop.get())b+="d";if(Q.menu.get())b+="m";if(Q.not.get())b="n";let D={app:n};if(b)D.shortcut=b;return console.log("Installing",n,D),Z("install",{},D)},c=T.get().includes(n),o=i.qs(".installed");if(o)o.innerHTML=c?"\uD83D\uDC9C Installed":"âŒ Not Installed";let w=i.qs(".install"),H=i.qs(".uninstall"),$=i.qs(".open-dir");if(c&&L)w.innerHTML="Update",w.onclick=async()=>{w.disabled=!0,w.textContent="Updating...",await f(),w.textContent="Update",w.disabled=!1,u("\uD83D\uDC9C Updated"),i.clR("has-update"),e(R,-1)},H.style.display="",H.onclick=()=>{if(w.disabled)return;y(`Are you sure you want to uninstall ${n}?`,async()=>{await Z("uninstall",{},{app:n}),l(T,(b)=>b.filter((D)=>D!==n)),h()})},$.style.display="",$.onclick=()=>{Gi(n)};else w.innerHTML="Install",w.onclick=()=>{let b=i.getAttribute("data-verified")==="true";y(`Are you sure you want to install ${n}?`,async()=>{w.disabled=!0,w.textContent="Installing...",await f(),T.get().push(n),w.textContent="Install",w.disabled=!1,h()},{showWarning:!b,shortcutOptions:!0})},H.style.display="none",$.style.display="none";let d=i.qs(".start");d.style.display=c||!L?"":"none",d.onclick=()=>{Z("start",{},{app:n})},i.qs(".open-gh").onclick=()=>{zi(n)}})}function zi(i){let n="https://github.com/"+i;if(L)window.zhiva_openExternal(n);else window.open(n,"_blank")}var W=qs("#update-all-btn");if(!L)W.disabled=!0,W.title=ni;W.onclick=async()=>{W.disabled=!0,W.textContent="Updating...";let n=await(await Z("update")).json();if(W.disabled=!1,W.textContent="Update All",n.err){u(`Error updating apps: ${n.msg}`);return}u("\uD83D\uDC9C Apps updated successfully!"),document.querySelectorAll(".repo-card").forEach((c)=>c.classList.remove("has-update"));let f=await Z("installed").then((c)=>c.json());if(f.err)return;T.set(f.apps),h()};function Gi(i){Z("open-dir",{},{app:i})}var C={};async function Ji(i){let n=`${J}${i}/HEAD/zhiva.json`;try{let f=await fetch(n);if(f.ok){let c=await f.json();C[i]=c}}catch{C[i]=null}}async function wi(i){let n=typeof i==="string"?i:i.name,f=C[n];if(f)return f;if(f===null)return{};return await Ji(n),C[n]}var Xi=["favicon.png","favicon.svg","public/favicon.png","public/favicon.svg"];async function Hi(i){let n=await wi(i);if(n.icon==="default"||!n.icon&&n.win_icon==="default")return"/zhiva-assets/zhiva.ico";if(n.icon||n.win_icon)return`${J}${i.name}/HEAD/${n.icon||n.win_icon}`;for(let f of Xi){let c=J+i.name+"/HEAD/"+f;try{if((await fetch(c,{method:"HEAD"})).ok)return c}catch{}}return null}var $i=a({selector:"#zhiva-repo-list",queryFunction:()=>vi(),template:(i)=>`
<div
    class="repo-card"
    data-name="${i.name}"
    data-verified="${i.verified}"
>
    <div class="repo-header">
        <div class="repo-icon">
            <div class="icon-placeholder">\uD83D\uDCE6</div>
        </div>
        <div class="repo-info">
            <div class="repo-title-row">
                <h3>
                    <a href="https://github.com/${i.name}" target="_blank">${i.name}</a>
                </h3>
                ${i.verified?`<span class="badge verified" title="Verified by Zhiva Team">
                    <img src="icons/verified.svg" width="12" height="12" alt="Verified">
                    <span>Verified</span>
                </span>`:""}
            </div>
            <span class="installed"></span>
        </div>
    </div>
    <div class="repo-body">
        <p class="repo-description">${i.desc||"No description provided."}</p>
    </div>
    <div class="repo-footer">
        <div class="repo-actions">
            <button class="btn-primary install">Install</button>
            <button class="btn-success start" style="display: none;">Launch</button>
            
            <div class="icon-actions">
                <button class="btn-icon uninstall" style="display: none; color: #ef4444;" title="Uninstall">
                    <img src="icons/uninstall.svg" width="18" height="18" alt="Uninstall">
                </button>
                <button class="btn-icon open-dir" title="Open Local Files">
                    <img src="icons/folder.svg" width="18" height="18" alt="Local">
                </button>
                <button class="btn-icon open-gh" title="Open on GitHub">
                    <img src="icons/github.svg" width="18" height="18" alt="GitHub">
                </button>
            </div>
        </div>
    </div>
</div>
    `,onData:(i)=>{i.forEach(async(n)=>{let f=await Hi(n),c=qs(`.repo-card[data-name="${n.name}"] .repo-icon`);if(!c)return;if(!f)return;let o=document.createElement("img");o.src=f,o.alt="\uD83D\uDCE6",o.width=32,o.height=32,c.innerHTML="",c.appendChild(o)}),setTimeout(()=>{h()},100)},sort:(i,n)=>n.stargazers_count-i.stargazers_count});async function vi(){let n=await(await Z("apps")).json();if(n.err)return[];return n.apps}Z("installed").then((i)=>i.json()).then((i)=>{if(i.err)return;T.set(i.apps),h()});I();ii();R.subscribe((i)=>{if(i<0)return R.set(0);if(!i)return z.innerHTML="No updates available";z.innerHTML=`Updates available for: ${i} app${i===1?"":"s"}.`});$i.load();

//# debugId=88084D33978C981E64756E2164756E21
//# sourceMappingURL=browser.js.map
