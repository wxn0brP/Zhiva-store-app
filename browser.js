var E={html(n){if(n!==void 0)return this.innerHTML=n,this;else return this.innerHTML},v(n){if(n!==void 0)return this.value=n,this;else return this.value},on(n,i){return this.addEventListener(n,i),this},css(n,i=null){if(typeof n==="string")if(i!==null)this.style[n]=i;else this.style.cssText=n;else Object.assign(this.style,n);return this},attrib(n,i=null){if(i!==null)return this.setAttribute(n,i),this;else return this.getAttribute(n)||""},clA(...n){return this.classList.add(...n),this},clR(...n){return this.classList.remove(...n),this},clT(n,i){return this.classList.toggle(n,i),this},animateFade(n,i={}){let{time:t=200,cb:o}=i,c=this,u=n===0?1:0,d=Math.min(1,Math.max(0,n)),e=performance.now();c.style.opacity=d.toString();function r(f){let s=f-e,h=Math.min(s/t,1),a=d+(u-d)*h;if(c.style.opacity=a.toString(),h<1)requestAnimationFrame(r);else c.style.opacity=u.toString(),o?.()}return requestAnimationFrame(r),this},fadeIn(...n){let i=_({display:"string",cb:"function",time:"number"},n),{display:t="block"}=i;return this.css("display",t),this.animateFade(0,i),this.fade=!0,this},fadeOut(...n){let i=_({cb:"function",time:"number"},n),t=i.time??300;return i.time=t,this.animateFade(1,{...i,cb:()=>{this.css("display","none"),i.cb?.()}}),this.fade=!1,this},async fadeInP(...n){return new Promise((i)=>{this.fadeIn(...n,()=>i(this))})},async fadeOutP(...n){return new Promise((i)=>{this.fadeOut(...n,()=>i(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(n){return this.appendChild(n),this},addUp(n){return this.insertBefore(n,this.firstChild),this},qs(n,i=0){if(i)n=`[data-id="${n}"]`;return this.querySelector(n)}};E.qi=E.qs;function _(n,i){let t={};if(i.length===0)return t;if(i.every((o)=>typeof o==="object"))return Object.assign({},...i);for(let o of i)for(let[c,u]of Object.entries(n))if(typeof o===u){t[c]=o;break}return t}Object.assign(HTMLElement.prototype,E);Object.assign(document,E);Object.assign(document.body,E);Object.assign(document.documentElement,E);window.qs=window.qi=E.qs.bind(document);class g{value;parent;listeners=[];isStore=!1;constructor(n,i){this.value=n,this.parent=i}get(){return this.value}set(n,i=0){return this.value=n,this.notify(i),this}notify(n=0){if(this.listeners.forEach((i)=>i(this.value)),n>0&&this.parent&&typeof this.parent.notify==="function")this.parent.notify(n-1);return this}subscribe(n){return this.listeners.push(n),this}}function M(n){return new Promise((i)=>setTimeout(i,n))}var y=window?.VQLClient?.fetchVQL;function S(n,i){let t=typeof n.selector==="string"?document.querySelector(n.selector):n.selector;if(!t)throw Error(`mountView: selector '${n.selector}' not found`);async function o(d={}){let e,r=Object.assign({},n.queryArgs,d);if(n.queryFunction)e=await n.queryFunction(r);else if(typeof n.query==="string")e=await y({query:n.query,var:d});else if(typeof n.query==="function")e=await y(await n.query(r));else if(typeof n.query==="object"&&!Array.isArray(n.query))e=await y(n.query);else e=r;if(n.onData)n.onData(e);if(n.transform)e=n.transform(e);if(n.onDataTransform)n.onDataTransform(e);if(n.sort){if(typeof n.sort==="function")e=e.sort(n.sort);else if(typeof n.sort==="string"){let f=n.sort;e=e.sort((s,h)=>{let a=s?.[f],b=h?.[f];return typeof a==="string"||typeof b==="string"?String(a).localeCompare(String(b)):(a??0)-(b??0)})}}if(n.onDataSort)n.onDataSort(e);c(e,n.templateDataMode??"replace")}if(n.events)for(let[d,e]of Object.entries(n.events))t.addEventListener(d,(r)=>{let f=r.target;for(let[s,h]of Object.entries(e)){let a=f.closest(s);if(a&&t.contains(a)){h(a,r);break}}});function c(d,e="replace"){let r="",f=!1;if(Array.isArray(d)&&d.length===0||typeof d==="object"&&d!==null&&Object.keys(d).length===0||d===null||d===void 0)r=n.emptyData??"",f=!0;else r=Array.isArray(d)?d.map(n.template).join(""):n.template(d);if(e==="append"||e==="prepend")if(f){if(t.innerHTML.trim()!==""&&t.getAttribute("data-fu-empty")!=="true")return;t.innerHTML=r,t.setAttribute("data-fu-empty","true")}else{if(t.getAttribute("data-fu-empty")==="true")t.innerHTML=r;else t.innerHTML=e==="append"?t.innerHTML+r:r+t.innerHTML;t.removeAttribute("data-fu-empty")}else if(t.innerHTML=r,f)t.setAttribute("data-fu-empty","true");else t.removeAttribute("data-fu-empty")}return Object.assign({element:t,mount:()=>{},load:o,render:c},i??{})}function k(n,i){return n.set(i(n.get())),n}function F(n,i=1){return n.set(n.get()+i),n}globalThis.lo=console.log;var x="https://raw.githubusercontent.com/",w=new g([]),L=new g(0),C=qs("#update-status"),P="Available only in desktop app";var on=new URLSearchParams(window.location.search),dn=on.get("secret");function R(n,i={},t={}){if(!n.startsWith("/"))n="/"+n;let o=new URL("/api"+n,window.location.origin);return Object.entries(t).forEach(([c,u])=>{o.searchParams.set(c,u.toString())}),fetch(o.toString(),{...i,headers:{...i.headers,"x-zhiva-token":dn}})}async function G(n,i={},t={}){console.log(`[BROWSER MODE] Mocked API call for: ${n}`,{options:i,query:t});let o=t?.app;switch(n){case"installed":return new Response(JSON.stringify({apps:[]}),{status:200,headers:{"Content-Type":"application/json"}});case"get-updates":return new Response(JSON.stringify({err:!1,updates:{}}),{status:200,headers:{"Content-Type":"application/json"}});case"install":return window.location.href=`zhiva://install/${o}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"start":return window.location.href=`zhiva://start/${o}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"uninstall":case"update":return console.warn(`Action "${n}" is not available in browser-only mode. Doing nothing.`),new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"apps":return new Response(JSON.stringify({err:!1,apps:await cn()}),{status:200,headers:{"Content-Type":"application/json"}});default:return console.error(`Endpoint not mocked for browser mode: ${n}`),new Response(JSON.stringify({err:!0,msg:"Endpoint not mocked for browser mode"}),{status:404,headers:{"Content-Type":"application/json"}})}}async function A(n,i,t,o=[]){let c=localStorage.getItem(n);if(c)return JSON.parse(c);let u=await t(...o);return localStorage.setItem(n,JSON.stringify(u)),setTimeout(()=>localStorage.removeItem(n),i),u}async function cn(){let n=await A("search",300000,un),i=await A("banned",300000,en);n=n.filter((o)=>!i.includes(o.name));let t=await A("verified",300000,rn,[n.map((o)=>o.name)]);return n.forEach((o)=>o.verified=t.includes(o.name)),console.log("Fetched apps:",n),n}async function un(){return(await fetch("https://api.github.com/search/repositories?q=topic:Zhiva-app").then((i)=>i.json())).items.map((i)=>({name:i.full_name,desc:i.description,stars:i.stargazers_count}))}async function U(n){return(await fetch(`https://raw.githubusercontent.com/wxn0brP/Zhiva-registry/HEAD/${n}.txt`).then((t)=>t.text())).split(`
`).map((t)=>t.split("#")[0].trim()).filter(Boolean)}async function en(){return await U("banned")}async function rn(n){let i=await U("verified");return i.push(...n.filter((t)=>t.startsWith("wxn0brP/"))),i}var m=typeof window.zhiva_isApp<"u";console.log("Running in",m?"desktop":"browser mode");var p=m?R:G;async function I(){l.disabled=!0,C.innerHTML="Checking...",document.querySelectorAll(".repo-card").forEach((c)=>c.classList.remove("has-update"));let i=await(await p("get-updates")).json(),t=i.updates;if(l.disabled=!m,i.err){console.error(`Error checking for updates: ${i.msg}`),C.innerHTML='<span style="color: red;">Error checking for updates</span>';return}let o=Object.keys(t).filter((c)=>t[c]);L.set(o.length),o.forEach((c)=>{let u=qs(`.repo-card[data-name="${c}"]`);if(u){u.classList.add("has-update");let d=u.qs(".install");if(d)d.textContent="Update available"}})}var l=qs("#check-updates-btn");if(!m)l.disabled=!0,l.title="";l.onclick=()=>{I(),localStorage.removeItem("reposCache")};var q=qs("#FD-message"),D=qs("#FD-prompt"),fn=(n,...i)=>{return n.replace(/\\\$|(?<!\\)\$/g,(t)=>{if(t==="\\$")return"$";return i.shift()?.toString()||"$"})};async function J(n,i={}){i={displayTime:6000,...i};let t=document.createElement("div");if(t.innerHTML=n,t.style.top=`-${t.offsetHeight+20}px`,i.className)t.classList.add(i.className);if(i.backgroundColor)t.style.backgroundColor=i.backgroundColor;let o=10,c=u();function u(){let r=0;for(let f of q.children)r+=f.offsetHeight+o;return r}let d=!1;async function e(){d=!0,t.style.top=`-${t.offsetHeight+20}px`,await M(700);for(let r of q.children){let f=r,s=parseInt(f.style.top.replace("px",""));f.style.top=`${s-o-t.offsetHeight}px`}t.remove()}if(t.addEventListener("click",e),i.onClick)t.addEventListener("click",i.onClick);if(q.appendChild(t),await M(100),t.style.top=`${10+c}px`,await M(i.displayTime-700),d)return;await e()}async function H(n,i={}){i={extraTime:0,...i};let t=0.3333333333333333,c={displayTime:(n.split(" ").length*t+6+i.extraTime)*1000,className:"uiMsg"};if(i.onClick)c.onClick=i.onClick;J(n,c)}async function sn(n,...i){let t="";if(i.length>0){if(Array.isArray(i[0]))t=i.shift()}n=fn(n,...i)+t,H(n)}async function an(n,i=""){return new Promise((t)=>{function o(){t(u.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+n+"<p><br />";let u=document.createElement("input");u.type="text",u.value=i,u.addEventListener("keydown",(e)=>{if(e.key=="Enter")o()}),c.appendChild(u),setTimeout(()=>{u.focus()},100),c.appendChild(document.createElement("br"));let d=document.createElement("button");d.innerHTML="OK",c.appendChild(d),d.addEventListener("click",o),D.appendChild(c),c.fadeIn()})}async function pn(n,i="OK",t="Cancel"){return new Promise((o)=>{function c(s){return()=>{o(s),u.fadeOut(),setTimeout(()=>{u.remove()},2000)}}let u=document.createElement("div");u.style.opacity="0",u.classList.add("prompt"),u.innerHTML="<p>"+n+"<p><br />";let d=document.createElement("div");d.style.display="flex",d.style.justifyContent="space-evenly";let e=document.createElement("button");e.innerHTML=t||"Cancel",e.addEventListener("click",c(!1)),d.appendChild(e);let r=document.createElement("button");r.innerHTML=i||"OK",r.addEventListener("click",c(!0)),d.appendChild(r);function f(s){if(s.key=="Enter")c(!0)();else if(s.key=="Escape")c(!1)();document.removeEventListener("keydown",f)}document.addEventListener("keydown",f),setTimeout(()=>{r.focus()},100),u.appendChild(d),D.appendChild(u),u.fadeIn()})}async function hn(n,i,t=[],o=[]){return new Promise((c)=>{function u(){c(e.value),d.fadeOut(),setTimeout(()=>{d.remove()},2000)}let d=document.createElement("div");d.style.opacity="0",d.classList.add("prompt"),d.innerHTML="<p>"+n+"<p><br />";let e=document.createElement("select");for(let f=0;f<o.length;f++){let s=o[f],h=document.createElement("optgroup");h.label=s.name;for(let a=0;a<s.options.length;a++){let b=document.createElement("option");b.value=s.options[a]||s.options[a],b.innerHTML=s.options[a],h.appendChild(b)}e.appendChild(h)}for(let f=0;f<i.length;f++){let s=document.createElement("option");s.value=t[f]||i[f],s.innerHTML=i[f],e.appendChild(s)}e.querySelector("option").selected=!0,d.appendChild(e),d.appendChild(document.createElement("br"));let r=document.createElement("button");r.innerHTML="OK",d.appendChild(r),r.addEventListener("click",u),D.appendChild(d),d.fadeIn()})}async function mn(n,i="datetime-local",t,o){return new Promise((c)=>{function u(){c(e.value),d.fadeOut(),setTimeout(()=>{d.remove()},2000)}let d=document.createElement("div");d.style.opacity="0",d.classList.add("prompt"),d.innerHTML="<p>"+n+"<p><br />";let e=document.createElement("input");if(e.type=i,e.value="00:00",t)e.min=new Date(t).toISOString();if(o)e.max=new Date(o).toISOString();e.addEventListener("keydown",(f)=>{if(f.key=="Enter")u()}),d.appendChild(e),setTimeout(()=>{e.focus()},100),d.appendChild(document.createElement("br"));let r=document.createElement("button");r.innerHTML="OK",d.appendChild(r),r.addEventListener("click",u),D.appendChild(d),d.fadeIn()})}window.FD={uiMessage:J,uiMsg:H,uiMsgT:sn,confirm:pn,prompt:an,selectPrompt:hn,promptTime:mn};var O=qs("#confirmation-modal"),W=qs("#modal-message"),X=qs("#modal-warning"),B=qs("#modal-confirm"),z=qs("#modal-cancel");function Z(n,i,t){if(!O||!W||!X||!B||!z)return;W.textContent=n,X.style.display=i?"block":"none",O.style.display="flex";let o=()=>{t(),u()},c=()=>{u()},u=()=>{O.style.display="none",B.removeEventListener("click",o),z.removeEventListener("click",c)};B.addEventListener("click",o),z.addEventListener("click",c)}function T(){document.querySelectorAll(".repo-card").forEach((n)=>{let i=n.getAttribute("data-name"),t=()=>p("install",{},{app:i}),o=w.get().includes(i),c=n.qs(".installed");if(c)c.innerHTML=o?"\uD83D\uDC9C Installed":"âŒ Not Installed";let u=n.qs(".install"),d=n.qs(".uninstall"),e=n.qs(".open-dir");if(o&&m)u.innerHTML="Update",u.onclick=async()=>{u.disabled=!0,u.textContent="Updating...",await t(),u.textContent="Update",u.disabled=!1,H("\uD83D\uDC9C Updated"),n.clR("has-update"),F(L,-1)},d.style.display="",d.onclick=()=>{if(u.disabled)return;Z(`Are you sure you want to uninstall ${i}?`,!1,async()=>{await p("uninstall",{},{app:i}),k(w,(f)=>f.filter((s)=>s!==i)),T()})},e.style.display="",e.onclick=()=>{En(i)};else u.innerHTML="Install",u.onclick=()=>{let f=n.getAttribute("data-verified")==="true";Z(`Are you sure you want to install ${i}?`,!f,async()=>{u.disabled=!0,u.textContent="Installing...",await t(),w.get().push(i),u.textContent="Install",u.disabled=!1,T()})},d.style.display="none",e.style.display="none";let r=n.qs(".start");r.style.display=o||!m?"":"none",r.onclick=()=>{p("start",{},{app:i})},n.qs(".open-gh").onclick=()=>{bn(i)}})}function bn(n){let i="https://github.com/"+n;if(m)window.zhiva_openExternal(i);else window.open(i,"_blank")}var v=qs("#update-all-btn");if(!m)v.disabled=!0,v.title=P;v.onclick=async()=>{v.disabled=!0,v.textContent="Updating...";let i=await(await p("update")).json();if(v.disabled=!1,v.textContent="Update All",i.err){H(`Error updating apps: ${i.msg}`);return}H("\uD83D\uDC9C Apps updated successfully!"),document.querySelectorAll(".repo-card").forEach((o)=>o.classList.remove("has-update"));let t=await p("installed").then((o)=>o.json());if(t.err)return;w.set(t.apps),T()};function En(n){p("open-dir",{},{app:n})}var $={};async function wn(n){let i=`${x}${n}/HEAD/zhiva.json`;try{let t=await fetch(i);if(t.ok){let o=await t.json();$[n]=o}}catch{$[n]=null}}async function Q(n){let i=typeof n==="string"?n:n.name,t=$[i];if(t)return t;if(t===null)return{};return await wn(i),$[i]}var Ln=["favicon.png","favicon.svg","public/favicon.png","public/favicon.svg"];async function Y(n){let i=await Q(n);if(i.icon==="default"||!i.icon&&i.win_icon==="default")return"/zhiva-assets/zhiva.ico";if(i.icon||i.win_icon)return`${x}${n.name}/HEAD/${i.icon||i.win_icon}`;for(let t of Ln){let o=x+n.name+"/HEAD/"+t;try{if((await fetch(o,{method:"HEAD"})).ok)return o}catch{}}return null}var K=S({selector:"#zhiva-repo-list",queryFunction:()=>vn(),template:(n)=>`
<div
    class="repo-card"
    data-name="${n.name}"
    data-verified="${n.verified}"
>
    <div class="repo-header">
        <div class="repo-icon">
            <div class="icon-placeholder">\uD83D\uDCE6</div>
        </div>
        <div class="repo-info">
            <div class="repo-title-row">
                <h3>
                    <a href="https://github.com/${n.name}" target="_blank">${n.name}</a>
                </h3>
                ${n.verified?`<span class="badge verified" title="Verified by Zhiva Team">
                    <img src="icons/verified.svg" width="12" height="12" alt="Verified">
                    <span>Verified</span>
                </span>`:""}
            </div>
            <span class="installed"></span>
        </div>
    </div>
    <div class="repo-body">
        <p class="repo-description">${n.desc||"No description provided."}</p>
    </div>
    <div class="repo-footer">
        <div class="repo-actions">
            <button class="btn-primary install">Install</button>
            <button class="btn-success start" style="display: none;">Launch</button>
            
            <div class="icon-actions">
                <button class="btn-icon uninstall" style="display: none; color: #ef4444;" title="Uninstall">
                    <img src="icons/uninstall.svg" width="18" height="18" alt="Uninstall">
                </button>
                <button class="btn-icon open-dir" title="Open Local Files">
                    <img src="icons/folder.svg" width="18" height="18" alt="Local">
                </button>
                <button class="btn-icon open-gh" title="Open on GitHub">
                    <img src="icons/github.svg" width="18" height="18" alt="GitHub">
                </button>
            </div>
        </div>
    </div>
</div>
    `,onData:(n)=>{n.forEach(async(i)=>{let t=await Y(i),o=qs(`.repo-card[data-name="${i.name}"] .repo-icon`);if(!o)return;if(!t)return;let c=document.createElement("img");c.src=t,c.alt="\uD83D\uDCE6",c.width=32,c.height=32,o.innerHTML="",o.appendChild(c)}),setTimeout(()=>{T()},100)},sort:(n,i)=>i.stargazers_count-n.stargazers_count});async function vn(){let i=await(await p("apps")).json();if(i.err)return[];return i.apps}p("installed").then((n)=>n.json()).then((n)=>{if(n.err)return;w.set(n.apps),T()});I();L.subscribe((n)=>{if(n<0)return L.set(0);if(!n)return C.innerHTML="No updates available";C.innerHTML=`Updates available for: ${n} app${n===1?"":"s"}.`});K.load();

//# debugId=215C33A6A9CB327264756E2164756E21
//# sourceMappingURL=browser.js.map
