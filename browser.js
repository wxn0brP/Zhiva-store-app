(()=>{var n=Object.defineProperty,i=(o,c)=>n(o,"name",{value:c,configurable:!0}),t={html(o){return o!==void 0?(this.innerHTML=o,this):this.innerHTML},v(o){return o!==void 0?(this.value=o,this):this.value},on(o,c){return this.addEventListener(o,c),this},css(o,c=null){return typeof o=="string"?c!==null?this.style[o]=c:this.style.cssText=o:Object.assign(this.style,o),this},attrib(o,c=null){return c!==null?(this.setAttribute(o,c),this):this.getAttribute(o)||""},clA(...o){return this.classList.add(...o),this},clR(...o){return this.classList.remove(...o),this},clT(o,c){return this.classList.toggle(o,c),this},animateFade(o,c={}){let{time:d=200,cb:u}=c,f=this,e=o===0?1:0,s=Math.min(1,Math.max(0,o)),E=performance.now();f.style.opacity=s.toString();function a(b){let Q=b-E,_=Math.min(Q/d,1),j=s+(e-s)*_;f.style.opacity=j.toString(),_<1?requestAnimationFrame(a):(f.style.opacity=e.toString(),u?.())}return i(a,"step"),requestAnimationFrame(a),this},fadeIn(...o){let c=r({display:"string",cb:"function",time:"number"},o),{display:d="block"}=c;return this.css("display",d),this.animateFade(0,c),this.fade=!0,this},fadeOut(...o){let c=r({cb:"function",time:"number"},o),d=c.time??300;return c.time=d,this.animateFade(1,{...c,cb:i(()=>{this.css("display","none"),c.cb?.()},"cb")}),this.fade=!1,this},async fadeInP(...o){return new Promise((c)=>{this.fadeIn(...o,()=>c(this))})},async fadeOutP(...o){return new Promise((c)=>{this.fadeOut(...o,()=>c(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(o){return this.appendChild(o),this},addUp(o){return this.insertBefore(o,this.firstChild),this},qs(o,c=0){return c&&(o=`[data-id="${o}"]`),this.querySelector(o)}};t.qi=t.qs;function r(o,c){let d={};if(c.length===0)return d;if(c.every((u)=>typeof u=="object"))return Object.assign({},...c);for(let u of c)for(let[f,e]of Object.entries(o))if(typeof u===e){d[f]=u;break}return d}i(r,"convert"),Object.assign(HTMLElement.prototype,t),Object.assign(document,t),Object.assign(document.body,t),Object.assign(document.documentElement,t),window.qs=window.qi=t.qs.bind(document)})();class H{value;parent;listeners=[];isStore=!1;constructor(n,i){this.value=n,this.parent=i}get(){return this.value}set(n,i=0){return this.value=n,this.notify(i),this}notify(n=0){if(this.listeners.forEach((i)=>i(this.value)),n>0&&this.parent&&typeof this.parent.notify==="function")this.parent.notify(n-1);return this}subscribe(n){return this.listeners.push(n),this}}function x(n){return new Promise((i)=>setTimeout(i,n))}var $=window?.VQLClient?.fetchVQL;function k(n,i){let t=typeof n.selector==="string"?document.querySelector(n.selector):n.selector;if(!t)throw Error(`mountView: selector '${n.selector}' not found`);async function r(d={}){let u,f=Object.assign({},n.queryArgs,d);if(n.queryFunction)u=await n.queryFunction(f);else if(typeof n.query==="string")u=await $({query:n.query,var:d});else if(typeof n.query==="function")u=await $(await n.query(f));else if(typeof n.query==="object"&&!Array.isArray(n.query))u=await $(n.query);else u=f;if(n.onData)n.onData(u);if(n.transform)u=n.transform(u);if(n.onDataTransform)n.onDataTransform(u);if(n.sort){if(typeof n.sort==="function")u=u.sort(n.sort);else if(typeof n.sort==="string"){let e=n.sort;u=u.sort((s,E)=>{let a=s?.[e],b=E?.[e];return typeof a==="string"||typeof b==="string"?String(a).localeCompare(String(b)):(a??0)-(b??0)})}}if(n.onDataSort)n.onDataSort(u);o(u,n.templateDataMode??"replace")}if(n.events)for(let[d,u]of Object.entries(n.events))t.addEventListener(d,(f)=>{let e=f.target;for(let[s,E]of Object.entries(u)){let a=e.closest(s);if(a&&t.contains(a)){E(a,f);break}}});function o(d,u="replace"){let f="",e=!1;if(Array.isArray(d)&&d.length===0||typeof d==="object"&&d!==null&&Object.keys(d).length===0||d===null||d===void 0)f=n.emptyData??"",e=!0;else f=Array.isArray(d)?d.map(n.template).join(""):n.template(d);if(u==="append"||u==="prepend")if(e){if(t.innerHTML.trim()!==""&&t.getAttribute("data-fu-empty")!=="true")return;t.innerHTML=f,t.setAttribute("data-fu-empty","true")}else{if(t.getAttribute("data-fu-empty")==="true")t.innerHTML=f;else t.innerHTML=u==="append"?t.innerHTML+f:f+t.innerHTML;t.removeAttribute("data-fu-empty")}else if(t.innerHTML=f,e)t.setAttribute("data-fu-empty","true");else t.removeAttribute("data-fu-empty")}return Object.assign({element:t,mount:()=>{},load:r,render:o},i??{})}function S(n,i){return n.set(i(n.get())),n}function F(n,i=1){return n.set(n.get()+i),n}globalThis.lo=console.log;var h="https://raw.githubusercontent.com/",v=new H([]),w=new H(0),C=qs("#update-status"),R="Available only in desktop app";var dn=new URLSearchParams(window.location.search),rn=dn.get("secret");function Z(n,i={},t={}){let r=new URL("/api/"+n,window.location.origin);return Object.entries(t).forEach(([o,c])=>{r.searchParams.set(o,c.toString())}),fetch(r.toString(),{...i,headers:{...i.headers,"x-zhiva-token":rn}})}async function G(n,i={},t={}){console.log(`[BROWSER MODE] Mocked API call for: ${n}`,{options:i,query:t});let r=t?.app;switch(n){case"installed":return new Response(JSON.stringify({apps:[]}),{status:200,headers:{"Content-Type":"application/json"}});case"get-updates":return new Response(JSON.stringify({err:!1,updates:{}}),{status:200,headers:{"Content-Type":"application/json"}});case"install":return window.location.href=`zhiva://install/${r}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"start":return window.location.href=`zhiva://start/${r}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"uninstall":case"update":return console.warn(`Action "${n}" is not available in browser-only mode. Doing nothing.`),new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"apps":return new Response(JSON.stringify({err:!1,apps:await un()}),{status:200,headers:{"Content-Type":"application/json"}});default:return console.error(`Endpoint not mocked for browser mode: ${n}`),new Response(JSON.stringify({err:!0,msg:"Endpoint not mocked for browser mode"}),{status:404,headers:{"Content-Type":"application/json"}})}}async function y(n,i,t,r=[]){let o=localStorage.getItem(n);if(o)return JSON.parse(o);let c=await t(...r);return localStorage.setItem(n,JSON.stringify(c)),setTimeout(()=>localStorage.removeItem(n),i),c}async function un(){let n=await y("search",300000,fn),i=await y("banned",300000,en);n=n.filter((r)=>!i.includes(r.name));let t=await y("verified",300000,sn,[n.map((r)=>r.name)]);return n.forEach((r)=>r.verified=t.includes(r.name)),console.log("Fetched apps:",n),n}async function fn(){return(await fetch("https://api.github.com/search/repositories?q=topic:Zhiva-app").then((i)=>i.json())).items.map((i)=>({name:i.full_name,desc:i.description,stars:i.stargazers_count}))}async function P(n){return(await fetch(`https://raw.githubusercontent.com/wxn0brP/Zhiva-registry/HEAD/${n}.txt`).then((t)=>t.text())).split(`
`).map((t)=>t.split("#")[0].trim()).filter(Boolean)}async function en(){return await P("banned")}async function sn(n){let i=await P("verified");return i.push(...n.filter((t)=>t.startsWith("wxn0brP/"))),i}var p=typeof window.zhiva_isApp<"u";console.log("Running in",p?"desktop":"browser mode");var m=p?Z:G;async function q(){l.disabled=!0,C.innerHTML="Checking...",document.querySelectorAll(".repo-card").forEach((o)=>o.classList.remove("has-update"));let i=await(await m("get-updates")).json(),t=i.updates;if(l.disabled=!p,i.err){console.error(`Error checking for updates: ${i.msg}`),C.innerHTML='<span style="color: red;">Error checking for updates</span>';return}let r=Object.keys(t).filter((o)=>t[o]);w.set(r.length),r.forEach((o)=>{let c=qs(`.repo-card[data-name="${o}"]`);if(c){c.classList.add("has-update");let d=c.qs(".install");if(d)d.textContent="Update available"}})}var l=qs("#check-updates-btn");if(!p)l.disabled=!0,l.title="";l.onclick=()=>{q(),localStorage.removeItem("reposCache")};var I=qs("#FD-message"),M=qs("#FD-prompt"),an=(n,...i)=>{return n.replace(/\\\$|(?<!\\)\$/g,(t)=>{if(t==="\\$")return"$";return i.shift()?.toString()||"$"})};async function U(n,i={}){i={displayTime:6000,...i};let t=document.createElement("div");if(t.innerHTML=n,t.style.top=`-${t.offsetHeight+20}px`,i.className)t.classList.add(i.className);if(i.backgroundColor)t.style.backgroundColor=i.backgroundColor;let r=10,o=c();function c(){let f=0;for(let e of I.children)f+=e.offsetHeight+r;return f}let d=!1;async function u(){d=!0,t.style.top=`-${t.offsetHeight+20}px`,await x(700);for(let f of I.children){let e=f,s=parseInt(e.style.top.replace("px",""));e.style.top=`${s-r-t.offsetHeight}px`}t.remove()}if(t.addEventListener("click",u),i.onClick)t.addEventListener("click",i.onClick);if(I.appendChild(t),await x(100),t.style.top=`${10+o}px`,await x(i.displayTime-700),d)return;await u()}async function L(n,i={}){i={extraTime:0,...i};let t=0.3333333333333333,o={displayTime:(n.split(" ").length*t+6+i.extraTime)*1000,className:"uiMsg"};if(i.onClick)o.onClick=i.onClick;U(n,o)}async function mn(n,...i){let t="";if(i.length>0){if(Array.isArray(i[0]))t=i.shift()}n=an(n,...i)+t,L(n)}async function pn(n,i=""){return new Promise((t)=>{function r(){t(c.value),o.fadeOut(),setTimeout(()=>{o.remove()},2000)}let o=document.createElement("div");o.style.opacity="0",o.classList.add("prompt"),o.innerHTML="<p>"+n+"<p><br />";let c=document.createElement("input");c.type="text",c.value=i,c.addEventListener("keydown",(u)=>{if(u.key=="Enter")r()}),o.appendChild(c),setTimeout(()=>{c.focus()},100),o.appendChild(document.createElement("br"));let d=document.createElement("button");d.innerHTML="OK",o.appendChild(d),d.addEventListener("click",r),M.appendChild(o),o.fadeIn()})}async function En(n,i="OK",t="Cancel"){return new Promise((r)=>{function o(s){return()=>{r(s),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+n+"<p><br />";let d=document.createElement("div");d.style.display="flex",d.style.justifyContent="space-evenly";let u=document.createElement("button");u.innerHTML=t||"Cancel",u.addEventListener("click",o(!1)),d.appendChild(u);let f=document.createElement("button");f.innerHTML=i||"OK",f.addEventListener("click",o(!0)),d.appendChild(f);function e(s){if(s.key=="Enter")o(!0)();else if(s.key=="Escape")o(!1)();document.removeEventListener("keydown",e)}document.addEventListener("keydown",e),setTimeout(()=>{f.focus()},100),c.appendChild(d),M.appendChild(c),c.fadeIn()})}async function bn(n,i,t=[],r=[]){return new Promise((o)=>{function c(){o(u.value),d.fadeOut(),setTimeout(()=>{d.remove()},2000)}let d=document.createElement("div");d.style.opacity="0",d.classList.add("prompt"),d.innerHTML="<p>"+n+"<p><br />";let u=document.createElement("select");for(let e=0;e<r.length;e++){let s=r[e],E=document.createElement("optgroup");E.label=s.name;for(let a=0;a<s.options.length;a++){let b=document.createElement("option");b.value=s.options[a]||s.options[a],b.innerHTML=s.options[a],E.appendChild(b)}u.appendChild(E)}for(let e=0;e<i.length;e++){let s=document.createElement("option");s.value=t[e]||i[e],s.innerHTML=i[e],u.appendChild(s)}u.querySelector("option").selected=!0,d.appendChild(u),d.appendChild(document.createElement("br"));let f=document.createElement("button");f.innerHTML="OK",d.appendChild(f),f.addEventListener("click",c),M.appendChild(d),d.fadeIn()})}async function vn(n,i="datetime-local",t,r){return new Promise((o)=>{function c(){o(u.value),d.fadeOut(),setTimeout(()=>{d.remove()},2000)}let d=document.createElement("div");d.style.opacity="0",d.classList.add("prompt"),d.innerHTML="<p>"+n+"<p><br />";let u=document.createElement("input");if(u.type=i,u.value="00:00",t)u.min=new Date(t).toISOString();if(r)u.max=new Date(r).toISOString();u.addEventListener("keydown",(e)=>{if(e.key=="Enter")c()}),d.appendChild(u),setTimeout(()=>{u.focus()},100),d.appendChild(document.createElement("br"));let f=document.createElement("button");f.innerHTML="OK",d.appendChild(f),f.addEventListener("click",c),M.appendChild(d),d.fadeIn()})}window.FD={uiMessage:U,uiMsg:L,uiMsgT:mn,confirm:En,prompt:pn,selectPrompt:bn,promptTime:vn};var O=qs("#confirmation-modal"),W=qs("#modal-message"),X=qs("#modal-warning"),A=qs("#modal-confirm"),B=qs("#modal-cancel");function z(n,i,t){if(!O||!W||!X||!A||!B)return;W.textContent=n,X.style.display=i?"block":"none",O.style.display="flex";let r=()=>{t(),c()},o=()=>{c()},c=()=>{O.style.display="none",A.removeEventListener("click",r),B.removeEventListener("click",o)};A.addEventListener("click",r),B.addEventListener("click",o)}function T(){document.querySelectorAll(".repo-card").forEach((n)=>{let i=n.getAttribute("data-name"),t=()=>m("install",{},{app:i}),r=v.get().includes(i),o=n.qs(".installed");if(o)o.innerHTML=r?"\uD83D\uDC9C Installed":"âŒ Not Installed";let c=n.qs(".install"),d=n.qs(".uninstall");if(r&&p)c.innerHTML="Update",c.onclick=async()=>{c.disabled=!0,c.textContent="Updating...",await t(),c.textContent="Update",c.disabled=!1,L("\uD83D\uDC9C Updated"),n.clR("has-update"),F(w,-1)},d.style.display="",d.onclick=()=>{if(c.disabled)return;z(`Are you sure you want to uninstall ${i}?`,!1,async()=>{await m("uninstall",{},{app:i}),S(v,(f)=>f.filter((e)=>e!==i)),T()})};else c.innerHTML="",c.onclick=()=>{let f=n.getAttribute("data-verified")==="true";z(`Are you sure you want to install ${i}?`,!f,async()=>{c.disabled=!0,c.textContent="Installing...",await t(),v.get().push(i),c.textContent="Install",c.disabled=!1,T()})},d.style.display="none";let u=n.qs(".start");u.style.display=r||!p?"":"none",u.onclick=()=>{m("start",{},{app:i})},n.qs(".open-gh").onclick=()=>{J(i)},n.qs("a").onclick=(f)=>{f.preventDefault(),J(i)}})}function J(n){let i="https://github.com/"+n;if(p)window.zhiva_openExternal(i);else window.open(i,"_blank")}var g=qs("#update-all-btn");if(!p)g.disabled=!0,g.title=R;g.onclick=async()=>{g.disabled=!0,g.textContent="Updating...";let i=await(await m("update")).json();if(g.disabled=!1,g.textContent="Update All",i.err){L(`Error updating apps: ${i.msg}`);return}L("\uD83D\uDC9C Apps updated successfully!"),document.querySelectorAll(".repo-card").forEach((r)=>r.classList.remove("has-update"));let t=await m("installed").then((r)=>r.json());if(t.err)return;v.set(t.apps),T()};var D={};async function wn(n){let i=`${h}${n}/HEAD/zhiva.json`;try{let t=await fetch(i);if(t.ok){let r=await t.json();D[n]=r}}catch{D[n]=null}}async function Y(n){let i=typeof n==="string"?n:n.name,t=D[i];if(t)return t;if(t===null)return{};return await wn(i),D[i]}var gn=["favicon.png","favicon.svg","public/favicon.png","public/favicon.svg"];async function K(n){let i=await Y(n);if(i.icon==="default"||!i.icon&&i.win_icon==="default")return"/zhiva-assets/zhiva.ico";if(i.icon||i.win_icon)return`${h}${n.name}/HEAD/${i.icon||i.win_icon}`;for(let t of gn){let r=h+n.name+"/HEAD/"+t;try{if((await fetch(r,{method:"HEAD"})).ok)return r}catch{}}return null}var N=k({selector:"#zhiva-repo-list",queryFunction:()=>Tn(),template:(n)=>`
        <div
            class="repo-card"
            data-name="${n.name}"
            data-verified="${n.verified}"
        >
            <div class="repo-header">
                <div class="repo-icon">
                    <div class="icon-placeholder">\uD83D\uDCE6</div>
                </div>
                <div class="repo-info">
                    <h3><a href="https://github.com/${n.name}">${n.name}</a></h3>
                    <span class="installed"></span>
                </div>
            </div>
            <p class="repo-description">${n.desc||"No description available."}</p>
            <div class="repo-actions">
                <button class="install">Install</button>
                <button class="uninstall" style="color: red">UnInstall</button>
                <button class="start">Start</button>
                <button class="open-gh">Open on GitHub</button>
            </div>
        </div>
    `,onData:(n)=>{n.forEach(async(i)=>{let t=await K(i),r=qs(`.repo-card[data-name="${i.name}"] .repo-icon`);if(!r)return;if(!t)return;let o=document.createElement("img");o.src=t,o.alt="\uD83D\uDCE6",o.width=32,o.height=32,r.innerHTML="",r.appendChild(o)}),setTimeout(()=>{T()},100)},sort:(n,i)=>i.stargazers_count-n.stargazers_count});async function Tn(){let i=await(await m("apps")).json();if(i.err)return[];return i.apps}m("installed").then((n)=>n.json()).then((n)=>{if(n.err)return;v.set(n.apps),T()});q();w.subscribe((n)=>{if(n<0)return w.set(0);if(!n)return C.innerHTML="No updates available";C.innerHTML=`Updates available for: ${n} app${n===1?"":"s"}.`});N.load();

//# debugId=C81CD7D8CC3F162164756E2164756E21
//# sourceMappingURL=browser.js.map
