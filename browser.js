var b={html(n){if(n!==void 0)return this.innerHTML=n,this;else return this.innerHTML},v(n){if(n!==void 0)return this.value=n,this;else return this.value},on(n,i){return this.addEventListener(n,i),this},css(n,i=null){if(typeof n==="string")if(i!==null)this.style[n]=i;else this.style.cssText=n;else Object.assign(this.style,n);return this},attrib(n,i=null){if(i!==null)return this.setAttribute(n,i),this;else return this.getAttribute(n)||""},clA(...n){return this.classList.add(...n),this},clR(...n){return this.classList.remove(...n),this},clT(n,i){return this.classList.toggle(n,i),this},animateFade(n,i={}){let{time:t=200,cb:o}=i,d=this,c=n===0?1:0,u=Math.min(1,Math.max(0,n)),f=performance.now();d.style.opacity=u.toString();function s(r){let e=r-f,E=Math.min(e/t,1),p=u+(c-u)*E;if(d.style.opacity=p.toString(),E<1)requestAnimationFrame(s);else d.style.opacity=c.toString(),o?.()}return requestAnimationFrame(s),this},fadeIn(...n){let i=X({display:"string",cb:"function",time:"number"},n),{display:t="block"}=i;return this.css("display",t),this.animateFade(0,i),this.fade=!0,this},fadeOut(...n){let i=X({cb:"function",time:"number"},n),t=i.time??300;return i.time=t,this.animateFade(1,{...i,cb:()=>{this.css("display","none"),i.cb?.()}}),this.fade=!1,this},async fadeInP(...n){return new Promise((i)=>{this.fadeIn(...n,()=>i(this))})},async fadeOutP(...n){return new Promise((i)=>{this.fadeOut(...n,()=>i(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(n){return this.appendChild(n),this},addUp(n){return this.insertBefore(n,this.firstChild),this},qs(n,i=0){if(i)n=`[data-id="${n}"]`;return this.querySelector(n)}};b.qi=b.qs;function X(n,i){let t={};if(i.length===0)return t;if(i.every((o)=>typeof o==="object"))return Object.assign({},...i);for(let o of i)for(let[d,c]of Object.entries(n))if(typeof o===c){t[d]=o;break}return t}Object.assign(HTMLElement.prototype,b);Object.assign(document,b);Object.assign(document.body,b);Object.assign(document.documentElement,b);window.qs=window.qi=b.qs.bind(document);var en=new URLSearchParams(window.location.search),pn=en.get("secret");function $(n,i={},t={}){if(!n.startsWith("/"))n="/"+n;let o=new URL("/api"+n,window.location.origin);return Object.entries(t).forEach(([d,c])=>{o.searchParams.set(d,c.toString())}),fetch(o.toString(),{...i,headers:{...i.headers,"x-zhiva-token":pn}})}async function Q(n,i={},t={},o={}){return await $(n,{method:"POST",...t,body:JSON.stringify(i),headers:{...t.headers,"Content-Type":"application/json"}},o).then((d)=>d.json())}async function Y(n,i={},t={}){return await $(n,i,t).then((o)=>o.json())}async function K(n,i={},t={}){console.log(`[BROWSER MODE] Mocked API call for: ${n}`,{options:i,query:t});let o=t?.app;switch(n){case"installed":return new Response(JSON.stringify({apps:[]}),{status:200,headers:{"Content-Type":"application/json"}});case"get-updates":return new Response(JSON.stringify({err:!1,updates:{}}),{status:200,headers:{"Content-Type":"application/json"}});case"install":return window.location.href=`zhiva://install/${o}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"start":return window.location.href=`zhiva://start/${o}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"uninstall":case"update":return console.warn(`Action "${n}" is not available in browser-only mode. Doing nothing.`),new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"apps":return new Response(JSON.stringify({err:!1,apps:await mn()}),{status:200,headers:{"Content-Type":"application/json"}});default:return console.error(`Endpoint not mocked for browser mode: ${n}`),new Response(JSON.stringify({err:!0,msg:"Endpoint not mocked for browser mode"}),{status:404,headers:{"Content-Type":"application/json"}})}}async function z(n,i,t,o=[]){let d=localStorage.getItem(n);if(d)return JSON.parse(d);let c=await t(...o);return localStorage.setItem(n,JSON.stringify(c)),setTimeout(()=>localStorage.removeItem(n),i),c}async function mn(){let n=await z("search",300000,hn),i=await z("banned",300000,an);n=n.filter((o)=>!i.includes(o.name));let t=await z("verified",300000,En,[n.map((o)=>o.name)]);return n.forEach((o)=>o.verified=t.includes(o.name)),console.log("Fetched apps:",n),n}async function hn(){return(await fetch("https://api.github.com/search/repositories?q=topic:Zhiva-app").then((i)=>i.json())).items.map((i)=>({name:i.full_name,desc:i.description,stars:i.stargazers_count}))}async function N(n){return(await fetch(`https://raw.githubusercontent.com/wxn0brP/Zhiva-registry/HEAD/${n}.txt`).then((t)=>t.text())).split(`
`).map((t)=>t.split("#")[0].trim()).filter(Boolean)}async function an(){return await N("banned")}async function En(n){let i=await N("verified");return i.push(...n.filter((t)=>t.startsWith("wxn0brP/"))),i}var h=typeof window.zhiva_isApp<"u";console.log("Running in",h?"desktop":"browser mode");var m=h?$:K;function O(n){return new Promise((i)=>setTimeout(i,n))}var F=qs("#FD-message"),q=qs("#FD-prompt"),Ln=(n,...i)=>{return n.replace(/\\\$|(?<!\\)\$/g,(t)=>{if(t==="\\$")return"$";return i.shift()?.toString()||"$"})};async function k(n,i={}){i={displayTime:6000,...i};let t=document.createElement("div");if(t.innerHTML=n,t.style.top=`-${t.offsetHeight+20}px`,i.className)t.classList.add(i.className);if(i.backgroundColor)t.style.backgroundColor=i.backgroundColor;let o=10,d=c();function c(){let s=0;for(let r of F.children)s+=r.offsetHeight+o;return s}let u=!1;async function f(){u=!0,t.style.top=`-${t.offsetHeight+20}px`,await O(700);for(let s of F.children){let r=s,e=parseInt(r.style.top.replace("px",""));r.style.top=`${e-o-t.offsetHeight}px`}t.remove()}if(t.addEventListener("click",f),i.onClick)t.addEventListener("click",i.onClick);if(F.appendChild(t),await O(100),t.style.top=`${10+d}px`,await O(i.displayTime-700),u)return;await f()}async function w(n,i={}){i={extraTime:0,...i};let t=0.3333333333333333,d={displayTime:(n.split(" ").length*t+6+i.extraTime)*1000,className:"uiMsg"};if(i.onClick)d.onClick=i.onClick;k(n,d)}async function bn(n,...i){let t="";if(i.length>0){if(Array.isArray(i[0]))t=i.shift()}n=Ln(n,...i)+t,w(n)}async function Tn(n,i=""){return new Promise((t)=>{function o(){t(c.value),d.fadeOut(),setTimeout(()=>{d.remove()},2000)}let d=document.createElement("div");d.style.opacity="0",d.classList.add("prompt"),d.innerHTML="<p>"+n+"<p><br />";let c=document.createElement("input");c.type="text",c.value=i,c.addEventListener("keydown",(f)=>{if(f.key=="Enter")o()}),d.appendChild(c),setTimeout(()=>{c.focus()},100),d.appendChild(document.createElement("br"));let u=document.createElement("button");u.innerHTML="OK",d.appendChild(u),u.addEventListener("click",o),q.appendChild(d),d.fadeIn()})}async function Hn(n,i="OK",t="Cancel"){return new Promise((o)=>{function d(e){return()=>{o(e),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+n+"<p><br />";let u=document.createElement("div");u.style.display="flex",u.style.justifyContent="space-evenly";let f=document.createElement("button");f.innerHTML=t||"Cancel",f.addEventListener("click",d(!1)),u.appendChild(f);let s=document.createElement("button");s.innerHTML=i||"OK",s.addEventListener("click",d(!0)),u.appendChild(s);function r(e){if(e.key=="Enter")d(!0)();else if(e.key=="Escape")d(!1)();document.removeEventListener("keydown",r)}document.addEventListener("keydown",r),setTimeout(()=>{s.focus()},100),c.appendChild(u),q.appendChild(c),c.fadeIn()})}async function vn(n,i,t=[],o=[]){return new Promise((d)=>{function c(){d(f.value),u.fadeOut(),setTimeout(()=>{u.remove()},2000)}let u=document.createElement("div");u.style.opacity="0",u.classList.add("prompt"),u.innerHTML="<p>"+n+"<p><br />";let f=document.createElement("select");for(let r=0;r<o.length;r++){let e=o[r],E=document.createElement("optgroup");E.label=e.name;for(let p=0;p<e.options.length;p++){let L=document.createElement("option");L.value=e.options[p]||e.options[p],L.innerHTML=e.options[p],E.appendChild(L)}f.appendChild(E)}for(let r=0;r<i.length;r++){let e=document.createElement("option");e.value=t[r]||i[r],e.innerHTML=i[r],f.appendChild(e)}f.querySelector("option").selected=!0,u.appendChild(f),u.appendChild(document.createElement("br"));let s=document.createElement("button");s.innerHTML="OK",u.appendChild(s),s.addEventListener("click",c),q.appendChild(u),u.fadeIn()})}async function ln(n,i="datetime-local",t,o){return new Promise((d)=>{function c(){d(f.value),u.fadeOut(),setTimeout(()=>{u.remove()},2000)}let u=document.createElement("div");u.style.opacity="0",u.classList.add("prompt"),u.innerHTML="<p>"+n+"<p><br />";let f=document.createElement("input");if(f.type=i,f.value="00:00",t)f.min=new Date(t).toISOString();if(o)f.max=new Date(o).toISOString();f.addEventListener("keydown",(r)=>{if(r.key=="Enter")c()}),u.appendChild(f),setTimeout(()=>{f.focus()},100),u.appendChild(document.createElement("br"));let s=document.createElement("button");s.innerHTML="OK",u.appendChild(s),s.addEventListener("click",c),q.appendChild(u),u.fadeIn()})}window.FD={uiMessage:k,uiMsg:w,uiMsgT:bn,confirm:Hn,prompt:Tn,selectPrompt:vn,promptTime:ln};var I=["listeners","value","notify","get","getPointer","set","subscribe","parent","isStore"];function _(n,i){let t={};for(let o in n)if(n.hasOwnProperty(o))if(typeof n[o]==="object"&&!Array.isArray(n[o])&&n[o]!==null)t[o]=_(n[o],t);else t[o]=new M(n[o],t);return t.isStore=!0,t.listeners=[],t.value=void 0,t.parent=i,t.notify=(o=0)=>{if(t.listeners.forEach((d)=>d(t)),o>0&&i&&typeof i.notify==="function")i.notify(o-1);return t},t.get=()=>{let o={};for(let d in t){if(I.includes(d))continue;if(t.hasOwnProperty(d))o[d]=t[d].get()}return o},t.getPointer=()=>{let o={};for(let d in t){if(I.includes(d))continue;if(t.hasOwnProperty(d))o[d]=t[d]}return o},t.set=(o,d=0)=>{for(let c in o){if(I.includes(c))throw Error(`Reserved key: ${c}`);if(!t.hasOwnProperty(c))throw Error(`Unknown key: ${c}`);if(t[c].isStore)throw Error(`Cannot set nested store: ${c}`);let f=o[c];if(typeof f==="object"&&f!==null&&!Array.isArray(f))throw Error(`Invalid value for key: ${c}`)}for(let c in o)t[c].set(o[c],d);return t},t.subscribe=(o)=>{return t.listeners.push(o),t},t}class M{value;parent;listeners=[];isStore=!1;constructor(n,i){this.value=n,this.parent=i}get(){return this.value}set(n,i=0){return this.value=n,this.notify(i),this}notify(n=0){if(this.listeners.forEach((i)=>i(this.value)),n>0&&this.parent&&typeof this.parent.notify==="function")this.parent.notify(n-1);return this}subscribe(n){return this.listeners.push(n),this}}function A(n,i,t=!1){if(t)i.set(n.checked);else n.checked=i.get();n.addEventListener("change",()=>{i.set(n.checked)}),i.subscribe((o)=>{if(n.checked!==o)n.checked=o})}var R=window?.VQLClient?.fetchVQL;function j(n,i){let t=typeof n.selector==="string"?document.querySelector(n.selector):n.selector;if(!t)throw Error(`mountView: selector '${n.selector}' not found`);async function o(u={}){let f,s=Object.assign({},n.queryArgs,u);if(n.queryFunction)f=await n.queryFunction(s,u);else if(typeof n.query==="string")f=await R({query:n.query,var:u});else if(typeof n.query==="function")f=await R(await n.query(s,u));else if(typeof n.query==="object"&&!Array.isArray(n.query))f=await R(n.query);else f=u;if(n.onData)n.onData(f);if(n.transform)f=n.transform(f);if(n.onDataTransform)n.onDataTransform(f);if(n.sort){if(typeof n.sort==="function")f=f.sort(n.sort);else if(typeof n.sort==="string"){let r=n.sort;f=f.sort((e,E)=>{let p=e?.[r],L=E?.[r];return typeof p==="string"||typeof L==="string"?String(p).localeCompare(String(L)):(p??0)-(L??0)})}}if(n.onDataSort)n.onDataSort(f);d(f,n.templateDataMode??"replace")}if(n.events)for(let[u,f]of Object.entries(n.events))t.addEventListener(u,(s)=>{let r=s.target;for(let[e,E]of Object.entries(f)){let p=r.closest(e);if(p&&t.contains(p)){E(p,s);break}}});function d(u,f="replace"){let s="",r=!1;if(Array.isArray(u)&&u.length===0||typeof u==="object"&&u!==null&&Object.keys(u).length===0||u===null||u===void 0)s=n.emptyData??"",r=!0;else s=Array.isArray(u)?u.map(n.template).join(""):n.template(u);if(f==="append"||f==="prepend")if(r){if(t.innerHTML.trim()!==""&&t.getAttribute("data-fu-empty")!=="true")return;t.innerHTML=s,t.setAttribute("data-fu-empty","true")}else{if(t.getAttribute("data-fu-empty")==="true")t.innerHTML=s;else t.innerHTML=f==="append"?t.innerHTML+s:s+t.innerHTML;t.removeAttribute("data-fu-empty")}else if(t.innerHTML=s,r)t.setAttribute("data-fu-empty","true");else t.removeAttribute("data-fu-empty")}return Object.assign({element:t,mount:()=>{},load:o,render:d},i??{})}function V(n,i){return n.set(i(n.get())),n}function nn(n,i=1){return n.set(n.get()+i),n}globalThis.lo=console.log;function B(n){let i=_({desktop:!1,menu:!1,not:!1}),t=n.qi("shortcut-not",1),o=n.qi("shortcut-desktop",1),d=n.qi("shortcut-menu",1);return i.not.subscribe((c)=>{if(c)o.disabled=!0,d.disabled=!0,o.checked=!1,d.checked=!1;else o.disabled=!1,d.disabled=!1}),A(o,i.desktop),A(d,i.menu),A(t,i.not),i}var W=qs("#settings"),G=qs("#save-shortcuts-btn"),yn=qs("#open-settings"),a=B(W);async function Dn(){let n=await Y("shortcut-pref");if(!n.err&&n.data)a.menu.set(n.data.includes("m")),a.desktop.set(n.data.includes("d")),a.not.set(n.data.includes("n"));else a.menu.set(!1),a.desktop.set(!1),a.not.set(!1);if(n.err)console.error("Failed to load shortcut preferences:",n),w("Error")}async function $n(){let n="";if(a.desktop.get())n+="d";if(a.menu.get())n+="m";if(a.not.get())n="n";G.disabled=!0;let i=await Q("shortcut-pref",{data:n});if(i.err){console.error("Failed to save shortcut preferences:",i),w("Error");return}w("\uD83D\uDC9C Preferences saved!"),G.disabled=!1}function tn(){if(!h)return;G.addEventListener("click",$n),W.fade=!1,yn.addEventListener("click",()=>W.fadeToggle()),Dn()}var C="https://raw.githubusercontent.com/",T=new M([]),H=new M(0),g=qs("#update-status"),on="Available only in desktop app";async function S(){x.disabled=!0,g.innerHTML="Checking...",document.querySelectorAll(".repo-card").forEach((d)=>d.classList.remove("has-update"));let i=await(await m("get-updates")).json(),t=i.updates;if(x.disabled=!h,i.err){console.error(`Error checking for updates: ${i.msg}`),g.innerHTML='<span style="color: red;">Error checking for updates</span>';return}let o=Object.keys(t).filter((d)=>t[d]);H.set(o.length),o.forEach((d)=>{let c=qs(`.repo-card[data-name="${d}"]`);if(c){c.classList.add("has-update");let u=c.qs(".install");if(u)u.textContent="Update available"}})}var x=qs("#check-updates-btn");if(!h)x.disabled=!0,x.title="";x.onclick=()=>{S(),localStorage.removeItem("reposCache")};var y=qs("#confirmation-modal"),dn=qs("#modal-message"),cn=qs("#modal-warning"),U=qs("#modal-confirm"),J=qs("#modal-cancel"),un=y.qs(".shortcut-options"),D=B(y);function P(n,i,t={}){if(!y||!dn||!cn||!U||!J)return;let o={showWarning:!1,...t};if(dn.textContent=n,cn.style.display=o.showWarning?"block":"none",y.style.display="flex",o.shortcutOptions)un.style.display="",D.set(a.get());else un.style.display="none";let d=()=>{i(),u()},c=()=>{u()},u=()=>{y.style.display="none",U.removeEventListener("click",d),J.removeEventListener("click",c)};U.addEventListener("click",d),J.addEventListener("click",c)}function l(){document.querySelectorAll(".repo-card").forEach((n)=>{let i=n.getAttribute("data-name"),t=()=>{let r="";if(D.desktop.get())r+="d";if(D.menu.get())r+="m";if(D.not.get())r="n";let e={app:i};if(r)e.shortcut=r;console.log("Installing",i,e),m("install",{},e)},o=T.get().includes(i),d=n.qs(".installed");if(d)d.innerHTML=o?"\uD83D\uDC9C Installed":"âŒ Not Installed";let c=n.qs(".install"),u=n.qs(".uninstall"),f=n.qs(".open-dir");if(o&&h)c.innerHTML="Update",c.onclick=async()=>{c.disabled=!0,c.textContent="Updating...",await t(),c.textContent="Update",c.disabled=!1,w("\uD83D\uDC9C Updated"),n.clR("has-update"),nn(H,-1)},u.style.display="",u.onclick=()=>{if(c.disabled)return;P(`Are you sure you want to uninstall ${i}?`,async()=>{await m("uninstall",{},{app:i}),V(T,(r)=>r.filter((e)=>e!==i)),l()})},f.style.display="",f.onclick=()=>{qn(i)};else c.innerHTML="Install",c.onclick=()=>{let r=n.getAttribute("data-verified")==="true";P(`Are you sure you want to install ${i}?`,async()=>{c.disabled=!0,c.textContent="Installing...",await t(),T.get().push(i),c.textContent="Install",c.disabled=!1,l()},{showWarning:!r,shortcutOptions:!0})},u.style.display="none",f.style.display="none";let s=n.qs(".start");s.style.display=o||!h?"":"none",s.onclick=()=>{m("start",{},{app:i})},n.qs(".open-gh").onclick=()=>{On(i)}})}function On(n){let i="https://github.com/"+n;if(h)window.zhiva_openExternal(i);else window.open(i,"_blank")}var v=qs("#update-all-btn");if(!h)v.disabled=!0,v.title=on;v.onclick=async()=>{v.disabled=!0,v.textContent="Updating...";let i=await(await m("update")).json();if(v.disabled=!1,v.textContent="Update All",i.err){w(`Error updating apps: ${i.msg}`);return}w("\uD83D\uDC9C Apps updated successfully!"),document.querySelectorAll(".repo-card").forEach((o)=>o.classList.remove("has-update"));let t=await m("installed").then((o)=>o.json());if(t.err)return;T.set(t.apps),l()};function qn(n){m("open-dir",{},{app:n})}var Z={};async function In(n){let i=`${C}${n}/HEAD/zhiva.json`;try{let t=await fetch(i);if(t.ok){let o=await t.json();Z[n]=o}}catch{Z[n]=null}}async function fn(n){let i=typeof n==="string"?n:n.name,t=Z[i];if(t)return t;if(t===null)return{};return await In(i),Z[i]}var An=["favicon.png","favicon.svg","public/favicon.png","public/favicon.svg"];async function rn(n){let i=await fn(n);if(i.icon==="default"||!i.icon&&i.win_icon==="default")return"/zhiva-assets/zhiva.ico";if(i.icon||i.win_icon)return`${C}${n.name}/HEAD/${i.icon||i.win_icon}`;for(let t of An){let o=C+n.name+"/HEAD/"+t;try{if((await fetch(o,{method:"HEAD"})).ok)return o}catch{}}return null}var sn=j({selector:"#zhiva-repo-list",queryFunction:()=>Bn(),template:(n)=>`
<div
    class="repo-card"
    data-name="${n.name}"
    data-verified="${n.verified}"
>
    <div class="repo-header">
        <div class="repo-icon">
            <div class="icon-placeholder">\uD83D\uDCE6</div>
        </div>
        <div class="repo-info">
            <div class="repo-title-row">
                <h3>
                    <a href="https://github.com/${n.name}" target="_blank">${n.name}</a>
                </h3>
                ${n.verified?`<span class="badge verified" title="Verified by Zhiva Team">
                    <img src="icons/verified.svg" width="12" height="12" alt="Verified">
                    <span>Verified</span>
                </span>`:""}
            </div>
            <span class="installed"></span>
        </div>
    </div>
    <div class="repo-body">
        <p class="repo-description">${n.desc||"No description provided."}</p>
    </div>
    <div class="repo-footer">
        <div class="repo-actions">
            <button class="btn-primary install">Install</button>
            <button class="btn-success start" style="display: none;">Launch</button>
            
            <div class="icon-actions">
                <button class="btn-icon uninstall" style="display: none; color: #ef4444;" title="Uninstall">
                    <img src="icons/uninstall.svg" width="18" height="18" alt="Uninstall">
                </button>
                <button class="btn-icon open-dir" title="Open Local Files">
                    <img src="icons/folder.svg" width="18" height="18" alt="Local">
                </button>
                <button class="btn-icon open-gh" title="Open on GitHub">
                    <img src="icons/github.svg" width="18" height="18" alt="GitHub">
                </button>
            </div>
        </div>
    </div>
</div>
    `,onData:(n)=>{n.forEach(async(i)=>{let t=await rn(i),o=qs(`.repo-card[data-name="${i.name}"] .repo-icon`);if(!o)return;if(!t)return;let d=document.createElement("img");d.src=t,d.alt="\uD83D\uDCE6",d.width=32,d.height=32,o.innerHTML="",o.appendChild(d)}),setTimeout(()=>{l()},100)},sort:(n,i)=>i.stargazers_count-n.stargazers_count});async function Bn(){let i=await(await m("apps")).json();if(i.err)return[];return i.apps}m("installed").then((n)=>n.json()).then((n)=>{if(n.err)return;T.set(n.apps),l()});S();tn();H.subscribe((n)=>{if(n<0)return H.set(0);if(!n)return g.innerHTML="No updates available";g.innerHTML=`Updates available for: ${n} app${n===1?"":"s"}.`});sn.load();

//# debugId=F7F46CB3C0866AF664756E2164756E21
//# sourceMappingURL=browser.js.map
