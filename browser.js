(()=>{var n=Object.defineProperty,i=(t,d)=>n(t,"name",{value:d,configurable:!0}),o={html(t){return t!==void 0?(this.innerHTML=t,this):this.innerHTML},v(t){return t!==void 0?(this.value=t,this):this.value},on(t,d){return this.addEventListener(t,d),this},css(t,d=null){return typeof t=="string"?d!==null?this.style[t]=d:this.style.cssText=t:Object.assign(this.style,t),this},attrib(t,d=null){return d!==null?(this.setAttribute(t,d),this):this.getAttribute(t)||""},clA(...t){return this.classList.add(...t),this},clR(...t){return this.classList.remove(...t),this},clT(t,d){return this.classList.toggle(t,d),this},animateFade(t,d={}){let{time:c=200,cb:e}=d,s=this,u=t===0?1:0,a=Math.min(1,Math.max(0,t)),l=performance.now();s.style.opacity=a.toString();function f(h){let K=h-l,S=Math.min(K/c,1),N=a+(u-a)*S;s.style.opacity=N.toString(),S<1?requestAnimationFrame(f):(s.style.opacity=u.toString(),e?.())}return i(f,"step"),requestAnimationFrame(f),this},fadeIn(...t){let d=r({display:"string",cb:"function",time:"number"},t),{display:c="block"}=d;return this.css("display",c),this.animateFade(0,d),this.fade=!0,this},fadeOut(...t){let d=r({cb:"function",time:"number"},t),c=d.time??300;return d.time=c,this.animateFade(1,{...d,cb:i(()=>{this.css("display","none"),d.cb?.()},"cb")}),this.fade=!1,this},async fadeInP(...t){return new Promise((d)=>{this.fadeIn(...t,()=>d(this))})},async fadeOutP(...t){return new Promise((d)=>{this.fadeOut(...t,()=>d(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(t){return this.appendChild(t),this},addUp(t){return this.insertBefore(t,this.firstChild),this},qs(t,d=0){return d&&(t=`[data-id="${t}"]`),this.querySelector(t)}};o.qi=o.qs;function r(t,d){let c={};if(d.length===0)return c;if(d.every((e)=>typeof e=="object"))return Object.assign({},...d);for(let e of d)for(let[s,u]of Object.entries(t))if(typeof e===u){c[s]=e;break}return c}i(r,"convert"),Object.assign(HTMLElement.prototype,o),Object.assign(document,o),Object.assign(document.body,o),Object.assign(document.documentElement,o),window.qs=window.qi=o.qs.bind(document)})();class x{value;parent;listeners=[];isStore=!1;constructor(n,i){this.value=n,this.parent=i}get(){return this.value}set(n,i=0){return this.value=n,this.notify(i),this}notify(n=0){if(this.listeners.forEach((i)=>i(this.value)),n>0&&this.parent&&typeof this.parent.notify==="function")this.parent.notify(n-1);return this}subscribe(n){return this.listeners.push(n),this}}function H(n){return new Promise((i)=>setTimeout(i,n))}var y=window?.VQLClient?.fetchVQL;function _(n,i){let o=typeof n.selector==="string"?document.querySelector(n.selector):n.selector;if(!o)throw Error(`mountView: selector '${n.selector}' not found`);async function r(c={}){let e,s=Object.assign({},n.queryArgs,c);if(n.queryFunction)e=await n.queryFunction(s);else if(typeof n.query==="string")e=await y({query:n.query,var:c});else if(typeof n.query==="function")e=await y(await n.query(s));else if(typeof n.query==="object"&&!Array.isArray(n.query))e=await y(n.query);else e=s;if(n.onData)n.onData(e);if(n.transform)e=n.transform(e);if(n.onDataTransform)n.onDataTransform(e);if(n.sort){if(typeof n.sort==="function")e=e.sort(n.sort);else if(typeof n.sort==="string"){let u=n.sort;e=e.sort((a,l)=>{let f=a?.[u],h=l?.[u];return typeof f==="string"||typeof h==="string"?String(f).localeCompare(String(h)):(f??0)-(h??0)})}}if(n.onDataSort)n.onDataSort(e);t(e,n.templateDataMode??"replace")}if(n.events)for(let[c,e]of Object.entries(n.events))o.addEventListener(c,(s)=>{let u=s.target;for(let[a,l]of Object.entries(e)){let f=u.closest(a);if(f&&o.contains(f)){l(f,s);break}}});function t(c,e="replace"){let s="",u=!1;if(Array.isArray(c)&&c.length===0||typeof c==="object"&&c!==null&&Object.keys(c).length===0||c===null||c===void 0)s=n.emptyData??"",u=!0;else s=Array.isArray(c)?c.map(n.template).join(""):n.template(c);if(e==="append"||e==="prepend")if(u){if(o.innerHTML.trim()!==""&&o.getAttribute("data-fu-empty")!=="true")return;o.innerHTML=s,o.setAttribute("data-fu-empty","true")}else{if(o.getAttribute("data-fu-empty")==="true")o.innerHTML=s;else o.innerHTML=e==="append"?o.innerHTML+s:s+o.innerHTML;o.removeAttribute("data-fu-empty")}else if(o.innerHTML=s,u)o.setAttribute("data-fu-empty","true");else o.removeAttribute("data-fu-empty")}return Object.assign({element:o,mount:()=>{},load:r,render:t},i??{})}function z(n,i){return n.set(i(n.get())),n}function R(n,i=1){return n.set(n.get()+i),n}globalThis.lo=console.log;var T="https://raw.githubusercontent.com/",g=new x([]),b=new x(0),C=qs("#update-status"),$="Available only in desktop app";var on=new URLSearchParams(window.location.search),cn=on.get("secret");function F(n,i={},o={}){let r=new URL("/api/"+n,window.location.origin);return Object.entries(o).forEach(([t,d])=>{r.searchParams.set(t,d.toString())}),fetch(r.toString(),{...i,headers:{...i.headers,"x-zhiva-token":cn}})}async function Z(n,i={},o={}){console.log(`[BROWSER MODE] Mocked API call for: ${n}`,{options:i,query:o});let r=o?.app;switch(n){case"installed":return new Response(JSON.stringify({apps:[]}),{status:200,headers:{"Content-Type":"application/json"}});case"get-updates":return new Response(JSON.stringify({err:!1,updates:{}}),{status:200,headers:{"Content-Type":"application/json"}});case"install":return window.location.href=`zhiva://install/${r}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"start":return window.location.href=`zhiva://start/${r}`,new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"open-gh":return window.open(`https://github.com/${r}`,"_blank"),new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});case"uninstall":case"update":return console.warn(`Action "${n}" is not available in browser-only mode. Doing nothing.`),new Response(JSON.stringify({err:!1}),{status:200,headers:{"Content-Type":"application/json"}});default:return new Response(JSON.stringify({err:!0,msg:"Endpoint not mocked for browser mode"}),{status:404,headers:{"Content-Type":"application/json"}})}}var m=typeof window.zhiva_isApp<"u";console.log("Running in",m?"desktop":"browser mode");var p=m?F:Z;async function I(){L.disabled=!0,C.innerHTML="Checking...",document.querySelectorAll(".repo-card").forEach((t)=>t.classList.remove("has-update"));let i=await(await p("get-updates")).json(),o=i.updates;if(L.disabled=!m,i.err){console.error(`Error checking for updates: ${i.msg}`),C.innerHTML='<span style="color: red;">Error checking for updates</span>';return}let r=Object.keys(o).filter((t)=>o[t]);b.set(r.length),r.forEach((t)=>{let d=qs(`.repo-card[data-name="${t}"]`);if(d){d.classList.add("has-update");let c=d.qs(".install");if(c)c.textContent="Update available"}})}var L=qs("#check-updates-btn");if(!m)L.disabled=!0,L.title="";L.onclick=()=>{I(),localStorage.removeItem("reposCache")};var q=qs("#FD-message"),D=qs("#FD-prompt"),dn=(n,...i)=>{return n.replace(/\\\$|(?<!\\)\$/g,(o)=>{if(o==="\\$")return"$";return i.shift()?.toString()||"$"})};async function P(n,i={}){i={displayTime:6000,...i};let o=document.createElement("div");if(o.innerHTML=n,o.style.top=`-${o.offsetHeight+20}px`,i.className)o.classList.add(i.className);if(i.backgroundColor)o.style.backgroundColor=i.backgroundColor;let r=10,t=d();function d(){let s=0;for(let u of q.children)s+=u.offsetHeight+r;return s}let c=!1;async function e(){c=!0,o.style.top=`-${o.offsetHeight+20}px`,await H(700);for(let s of q.children){let u=s,a=parseInt(u.style.top.replace("px",""));u.style.top=`${a-r-o.offsetHeight}px`}o.remove()}if(o.addEventListener("click",e),i.onClick)o.addEventListener("click",i.onClick);if(q.appendChild(o),await H(100),o.style.top=`${10+t}px`,await H(i.displayTime-700),c)return;await e()}async function v(n,i={}){i={extraTime:0,...i};let o=0.3333333333333333,t={displayTime:(n.split(" ").length*o+6+i.extraTime)*1000,className:"uiMsg"};if(i.onClick)t.onClick=i.onClick;P(n,t)}async function en(n,...i){let o="";if(i.length>0){if(Array.isArray(i[0]))o=i.shift()}n=dn(n,...i)+o,v(n)}async function rn(n,i=""){return new Promise((o)=>{function r(){o(d.value),t.fadeOut(),setTimeout(()=>{t.remove()},2000)}let t=document.createElement("div");t.style.opacity="0",t.classList.add("prompt"),t.innerHTML="<p>"+n+"<p><br />";let d=document.createElement("input");d.type="text",d.value=i,d.addEventListener("keydown",(e)=>{if(e.key=="Enter")r()}),t.appendChild(d),setTimeout(()=>{d.focus()},100),t.appendChild(document.createElement("br"));let c=document.createElement("button");c.innerHTML="OK",t.appendChild(c),c.addEventListener("click",r),D.appendChild(t),t.fadeIn()})}async function sn(n,i="OK",o="Cancel"){return new Promise((r)=>{function t(a){return()=>{r(a),d.fadeOut(),setTimeout(()=>{d.remove()},2000)}}let d=document.createElement("div");d.style.opacity="0",d.classList.add("prompt"),d.innerHTML="<p>"+n+"<p><br />";let c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-evenly";let e=document.createElement("button");e.innerHTML=o||"Cancel",e.addEventListener("click",t(!1)),c.appendChild(e);let s=document.createElement("button");s.innerHTML=i||"OK",s.addEventListener("click",t(!0)),c.appendChild(s);function u(a){if(a.key=="Enter")t(!0)();else if(a.key=="Escape")t(!1)();document.removeEventListener("keydown",u)}document.addEventListener("keydown",u),setTimeout(()=>{s.focus()},100),d.appendChild(c),D.appendChild(d),d.fadeIn()})}async function un(n,i,o=[],r=[]){return new Promise((t)=>{function d(){t(e.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+n+"<p><br />";let e=document.createElement("select");for(let u=0;u<r.length;u++){let a=r[u],l=document.createElement("optgroup");l.label=a.name;for(let f=0;f<a.options.length;f++){let h=document.createElement("option");h.value=a.options[f]||a.options[f],h.innerHTML=a.options[f],l.appendChild(h)}e.appendChild(l)}for(let u=0;u<i.length;u++){let a=document.createElement("option");a.value=o[u]||i[u],a.innerHTML=i[u],e.appendChild(a)}e.querySelector("option").selected=!0,c.appendChild(e),c.appendChild(document.createElement("br"));let s=document.createElement("button");s.innerHTML="OK",c.appendChild(s),s.addEventListener("click",d),D.appendChild(c),c.fadeIn()})}async function an(n,i="datetime-local",o,r){return new Promise((t)=>{function d(){t(e.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+n+"<p><br />";let e=document.createElement("input");if(e.type=i,e.value="00:00",o)e.min=new Date(o).toISOString();if(r)e.max=new Date(r).toISOString();e.addEventListener("keydown",(u)=>{if(u.key=="Enter")d()}),c.appendChild(e),setTimeout(()=>{e.focus()},100),c.appendChild(document.createElement("br"));let s=document.createElement("button");s.innerHTML="OK",c.appendChild(s),s.addEventListener("click",d),D.appendChild(c),c.fadeIn()})}window.FD={uiMessage:P,uiMsg:v,uiMsgT:en,confirm:sn,prompt:rn,selectPrompt:un,promptTime:an};var O=qs("#confirmation-modal"),G=qs("#modal-message"),J=qs("#modal-warning"),A=qs("#modal-confirm"),B=qs("#modal-cancel");function k(n,i,o){if(!O||!G||!J||!A||!B)return;G.textContent=n,J.style.display=i?"block":"none",O.style.display="flex";let r=()=>{o(),d()},t=()=>{d()},d=()=>{O.style.display="none",A.removeEventListener("click",r),B.removeEventListener("click",t)};A.addEventListener("click",r),B.addEventListener("click",t)}function E(){document.querySelectorAll(".repo-card").forEach((n)=>{let i=n.getAttribute("data-name"),o=n.getAttribute("data-owner"),r=()=>p("install",{},{app:i}),t=m?g.get().includes(i):!0,d=n.qs(".installed");if(d)d.innerHTML=t?"\uD83D\uDC9C Installed":"âŒ Not Installed";let c=n.qs(".install"),e=n.qs(".uninstall");if(t){if(c.innerHTML=m?"Update":"Install",!m)c.title="The browser cannot access the application state";if(c.onclick=async()=>{c.disabled=!0,c.textContent="Updating...",await r(),c.textContent="Update",c.disabled=!1,v("\uD83D\uDC9C Updated"),n.clR("has-update"),R(b,-1)},e.style.display="",!m)e.disabled=!0,e.title=$;e.onclick=()=>{if(c.disabled)return;k(`Are you sure you want to uninstall ${i}?`,!1,async()=>{await p("uninstall",{},{app:i}),z(g,(u)=>u.filter((a)=>a!==i)),E()})}}else c.innerHTML="Install",c.onclick=()=>{let u=o==="wxn0brP";k(`Are you sure you want to install ${i}?`,!u,async()=>{c.disabled=!0,c.textContent="Installing...",await r(),g.get().push(i),c.textContent="Install",c.disabled=!1,E()})},e.style.display="none";let s=n.qs(".start");s.style.display=t?"":"none",s.onclick=()=>{p("start",{},{app:i})},n.qs(".open-gh").onclick=()=>{p("open-gh",{},{app:i})},n.qs("a").onclick=(u)=>{u.preventDefault(),p("open-gh",{},{app:i})}})}var w=qs("#update-all-btn");if(!m)w.disabled=!0,w.title=$;w.onclick=async()=>{w.disabled=!0,w.textContent="Updating...";let i=await(await p("update")).json();if(w.disabled=!1,w.textContent="Update All",i.err){v(`Error updating apps: ${i.msg}`);return}v("\uD83D\uDC9C Apps updated successfully!"),document.querySelectorAll(".repo-card").forEach((r)=>r.classList.remove("has-update"));let o=await p("installed").then((r)=>r.json());if(o.err)return;g.set(o.apps),E()};var M={};async function fn(n){let i=`${T}${n}/HEAD/zhiva.json`;try{let o=await fetch(i);if(o.ok){let r=await o.json();M[n]=r}}catch{M[n]=null}}async function U(n){let i=typeof n==="string"?n:n.full_name,o=M[i];if(o)return o;if(o===null)return{};return await fn(i),M[i]}var pn=["favicon.png","favicon.svg","public/favicon.png","public/favicon.svg"];async function W(n){let i=await U(n);if(i.icon==="default"||!i.icon&&i.win_icon==="default")return"/zhiva-assets/zhiva.ico";if(i.icon||i.win_icon)return`${T}${n.full_name}/HEAD/${i.icon||i.win_icon}`;for(let o of pn){let r=T+n.full_name+"/HEAD/"+o;try{if((await fetch(r,{method:"HEAD"})).ok)return r}catch{}}return null}async function X(){let n=localStorage.getItem("reposCache");if(n)try{let t=JSON.parse(n);if(t.time>Date.now())return t.data;localStorage.removeItem("reposCache")}catch(t){console.warn("Cache parsing failed",t)}let r=(await(await fetch("https://api.github.com/search/repositories?q=topic:Zhiva-app")).json()).items||[];return localStorage.setItem("reposCache",JSON.stringify({time:Date.now()+600000,data:r})),r}var Y=_({selector:"#zhiva-repo-list",queryFunction:()=>X(),template:(n)=>`
        <div class="repo-card" data-id="${n.id}" data-name="${n.full_name}" data-owner="${n.owner.login}">
            <div class="repo-header">
                <div class="repo-icon">
                    <div class="icon-placeholder">\uD83D\uDCE6</div>
                </div>
                <div class="repo-info">
                    <h3><a href="${n.html_url}">${n.full_name}</a></h3>
                    <span class="installed"></span>
                </div>
            </div>
            <p class="repo-description">${n.description||"No description available."}</p>
            <div class="repo-actions">
                <button class="install">Install</button>
                <button class="uninstall" style="color: red">UnInstall</button>
                <button class="start">Start</button>
                <button class="open-gh">Open on GitHub</button>
            </div>
        </div>
    `,onData:(n)=>{n.forEach(async(i)=>{let o=await W(i),r=qs(`.repo-card[data-id="${i.id}"] .repo-icon`);if(!r)return;if(!o)return;let t=document.createElement("img");t.src=o,t.alt="\uD83D\uDCE6",t.width=32,t.height=32,r.innerHTML="",r.appendChild(t)}),setTimeout(()=>{E()},100)},sort:(n,i)=>i.stargazers_count-n.stargazers_count});p("installed").then((n)=>n.json()).then((n)=>{if(n.err)return;g.set(n.apps),E()});I();b.subscribe((n)=>{if(n<0)return b.set(0);if(!n)return C.innerHTML="No updates available";C.innerHTML=`Updates available for: ${n} app${n===1?"":"s"}.`});Y.load();

//# debugId=6895136E974753A264756E2164756E21
//# sourceMappingURL=browser.js.map
